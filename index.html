<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKUscale - Stop Guessing, Start Scaling</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .recommended-plan { transform: scale(1.05  ); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1), 0 0 0 2px #4f46e5; }
        /* Añadimos un estilo para los botones desactivados */
        .login-trigger:disabled { cursor: not-allowed; background-color: #9ca3af; }
    </style>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header (sin cambios ) -->
    <header><!-- ... --></header>

    <!-- Hero Section -->
    <main class="container mx-auto px-6 pt-16 pb-12 md:pt-24 md:pb-20 text-center">
        <!-- ... -->
        <div class="mt-8">
            <!-- AHORA: Añadimos 'disabled' a los botones para que empiecen desactivados -->
            <button disabled class="login-trigger bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-transform transform hover:scale-105 text-lg" data-lang="en">Get Your Free SKU Classification</button>
            <button disabled class="login-trigger bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-transform transform hover:scale-105 text-lg" data-lang="es" style="display:none;">Consigue tu Clasificación Gratis</button>
        </div>
    </main>

    <!-- Solution Section (sin cambios) -->
    <section class="py-16 md:py-24 bg-white"><!-- ... --></section>

    <!-- Pricing Section -->
    <section id="pricing" class="py-16 md:py-24">
        <div class="container mx-auto px-6">
            <!-- ... -->
            <div class="flex flex-col lg:flex-row justify-center items-center gap-8">
                <!-- AHORA: Añadimos 'disabled' a todos los botones de login -->
                <div class="bg-white border border-gray-200 p-8 rounded-lg w-full max-w-md lg:max-w-sm"><h4 class="text-2xl font-bold text-gray-900">FREE</h4><p class="text-5xl font-extrabold my-4"><span data-lang="en">$0</span><span data-lang="es" style="display:none;">0€</span></p><!-- ... --><div class="mt-8"><button disabled class="login-trigger w-full bg-gray-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-black" data-lang="en">Start for Free</button><button disabled class="login-trigger w-full bg-gray-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-black" data-lang="es" style="display:none;">Empieza Gratis</button></div></div>
                <div class="bg-white border border-gray-200 p-8 rounded-lg w-full max-w-md relative recommended-plan"><!-- ... --><div class="mt-8"><button disabled class="login-trigger w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700" data-lang="en">Choose Growth</button><button disabled class="login-trigger w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700" data-lang="es" style="display:none;">Elegir Growth</button></div></div>
                <div class="bg-white border border-gray-200 p-8 rounded-lg w-full max-w-md lg:max-w-sm"><!-- ... --><div class="mt-8"><button disabled class="login-trigger w-full bg-gray-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-black" data-lang="en">Choose Scale</button><button disabled class="login-trigger w-full bg-gray-800 text-white font-bold py-3 px-6 rounded-lg hover:bg-black" data-lang="es" style="display:none;">Elegir Scale</button></div></div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-800 text-white py-8"><!-- ... --></footer>
    
    <script>
        // --- LÓGICA DE CAMBIO DE IDIOMA (Sin cambios) ---
        // ...

        // --- LÓGICA DE AUTENTICACIÓN CON AUTH0 (ROBUSTA) ---
        let auth0Client = null;
        const loginButtons = document.querySelectorAll('.login-trigger');

        // Función de login, simple y directa
        const login = async () => {
            if (!auth0Client) return; // Doble seguridad
            try {
                await auth0Client.loginWithRedirect({
                    authorizationParams: {
                        redirect_uri: window.location.origin + '/dashboard.html'
                    }
                });
            } catch (e) {
                console.error("Error al redirigir para el login:", e);
            }
        };

        // Asignamos la función de login a los botones
        loginButtons.forEach(el => {
            el.addEventListener('click', (e) => {
                e.preventDefault();
                login();
            });
        });

        // Lógica principal que se ejecuta al cargar la página
        const main = async () => {
            try {
                auth0Client = await auth0.createAuth0Client({
                    domain: "nml.eu.auth0.com",
                    clientId: "6ds6S2Ltn7fJ7y5PjPmhFqe50AbTlp5a"
                });
            } catch (e) {
                console.error("Error fatal al inicializar Auth0:", e);
                // Si Auth0 falla, los botones permanecerán desactivados.
                return;
            }

            const query = window.location.search;

            // CASO 1: La URL es un callback de Auth0
            if (query.includes("code=") && query.includes("state=")) {
                await auth0Client.handleRedirectCallback();
                window.location.replace('/dashboard.html');
                return;
            }

            // CASO 2: La URL está limpia, comprobamos sesión
            const isAuthenticated = await auth0Client.isAuthenticated();
            if (isAuthenticated) {
                window.location.href = '/dashboard.html';
                return;
            }

            // SI LLEGAMOS AQUÍ, significa que Auth0 está listo y el usuario no está logueado.
            // Es el momento de activar los botones.
            loginButtons.forEach(button => {
                button.disabled = false;
            });
        };

        // Ejecutamos la función principal al cargar la ventana.
        window.addEventListener('load', main);
    </script>
</body>
</html>
